<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3/dist/css/bootstrap.min.css" rel="stylesheet"> 
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Roboto+Slab:wght@400;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=Pacifico&family=Playwrite+GB+S:ital,wght@0,100..400;1,100..400&display=swap">

    <!-- fonts and navbar -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"> 
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=Pacifico&family=Playwrite+GB+S:ital,wght@0,100..400;1,100..400&display=swap" rel="stylesheet"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" /> 
    <link rel="stylesheet" href="navbar.css"> 


    <title>Profile</title>
    <style>
        body { 
            font-family: 'Montserrat', sans-serif; 
            background-color: #e1e7e4;
            margin: 0; 
            padding: 0; 
        } 
        .header { 
            position: relative; 
            height: 100vh; 
            background-image: url('./countryPics/mountains.jpg') !important; 
            background-size: cover; 
            background-position: center; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: white; 
        } 
        .header::before { 
            content: ""; 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0, 0, 0, 0.5); /* Dark overlay */ 
            background: linear-gradient(to bottom right, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.2)); /* Gradient effect */ 
        } 
        #navbar-app{ 
            position: absolute;  
            top: 0;  
            width: 100%;  
            z-index: 2;       
        }

        .main-content {
            margin-top: 60px;
            padding: 20px;
        }

        /* Profile Container Styles */
        .profile-container {
            position: absolute;
            top: 100px;
            left: 0;
            right: 0;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            z-index: 1;
        }

        /* Sidebar Styles */
        .sidebar {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .user-info {
            text-align: center;
            margin-bottom: 30px;
        }

        .user-info img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin-bottom: 15px;
        }

        .settings-menu a {
            display: block;
            padding: 10px;
            color: black;
            text-decoration: none;
            border-radius: 5px;
            margin-bottom: 5px;
        }

        .settings-menu a:hover {
            background-color: #764F37;
            color: white;
        }

        /* Main Content Styles */
        .main-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Game Section Styles */
        .language-game {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .game-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }

        .game-input-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin-top: 15px;
        }

        .game-input-group input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            max-width: 300px;
        }

        .game-input-group button {
            white-space: nowrap;
        }

        /* Badges Section */
        .badges-section {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .badge {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .badge-image {
            width: 100%;
            height: 120px;
            margin-bottom: 10px;
        }

        .badge-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .badge-info {
            text-align: center;
        }

        .badge-info h4 {
            color: #764F37;
            margin-bottom: 5px;
        }

        .badge-info p {
            color: #666;
            font-size: 0.9em;
            margin: 0;
        }

        /* Tab Styles */
        .tab-buttons {
            display: flex;
            margin-bottom: 20px;
        }

        .tab-button {
            padding: 10px 20px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            color: #764F37;
        }

        .tab-button.active {
            border-bottom-color: #B5855B;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Keep your existing container styles */
        .container {
            background-color: #fff;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        footer { 
            text-align: center; 
            padding: 20px; 
            color: white; 
            background-color: #764F37; 
            box-shadow: 0 -4px 8px rgba(0, 0, 0, 0.1); 
            font-family: 'Montserrat', sans-serif; 
            width: 100%; 
            height: 60px;
            position: absolute; 
            bottom: 0;
            left: 0;
            margin-bottom: 0; 
        }
    </style>
</head>
<body>
    <div>
        <div id="navbar-app">
            <navbar-component></navbar-component>
        </div>

        <script type='module' src="navbarLoader.js"></script>
    </div>
    <div class="header">   
    </div>

    <div class="profile-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="user-info">
                <img src="dp.png" alt="Profile Picture">
                <h3>John Doe</h3> <!-- get user info here -->
            </div>
            <div class="settings-menu">
                <a href="#" class="tab-link" data-tab="account">Account Settings</a>
                <a href="#" class="tab-link" data-tab="game">Language Game</a>
                <a href="#" class="tab-link" data-tab="badges">My Badges</a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-section">
            <!-- Account Settings Tab -->
            <div id="account" class="tab-content">
                <h2>Account Settings</h2>
                <form id="settings-form">
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="username" required>
                    </div>
                    <div id="alert-container" style="display: none;">
                        <div class="alert" role="alert"></div>
                    </div>
                    <button type="submit" class="btn btn-primary" id="save-profile-btn">
                        <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                        Save Changes
                    </button>
                </form>

                <hr>
<!-- 
                <h3>Profile Picture</h3>
                <div class="mb-4">
                    <label for="profilePic" class="form-label">Update Profile Picture</label>
                    <input type="file" class="form-control" id="profilePic" accept="image/*" 
                           onchange="updateProfilePicture(this.files[0])">
                </div> -->
                <h3>Profile Picture</h3>
                <div class="mb-4">
                    <div class="d-flex align-items-center mb-3">
                        <img id="profile-preview" src="dp.png" alt="Profile Picture" 
                            class="rounded-circle me-3" style="width: 100px; height: 100px; object-fit: cover;">
                        <div>
                            <label for="profilePic" class="form-label">Update Profile Picture</label>
                            <input type="file" class="form-control" id="profilePic" accept="image/*">
                        </div>
                    </div>
                    <div id="upload-progress" class="progress mb-2 d-none">
                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                    </div>
                </div>

                <hr>

                <button onclick="logout()" class="btn btn-danger">Logout</button>
            </div>

            <!-- Language Game Tab -->
            <div id="game" class="tab-content">
                <h2>Language Learning Game</h2>
                <div class="language-game">
                    <div class="game-card">
                        <h3>Current Word</h3>
                        <p id="current-word">Bonjour</p>
                        <div class="game-input-group">
                            <input type="text" id="answer" placeholder="Type the translation" onkeypress="if(event.key === 'Enter') checkAnswer()">
                            <button id="submit-answer" class="btn btn-primary">Submit</button>
                        </div>
                    </div>
                    <div class="score-display">
                        <p>Score: <span id="score">0</span></p>
                        <p>Streak: <span id="streak">0</span></p>
                    </div>
                </div>
            </div>

            <!-- Badges Tab -->
            <div id="badges" class="tab-content">
                <h2>My Badges</h2>
                <div class="badges-section">
                    <div class="badge">
                        <div class="badge-image">
                            <img src="https://www.shutterstock.com/shutterstock/photos/1167030424/display_1500/stock-vector-mountain-illustration-outdoor-adventure-vector-graphic-for-t-shirt-and-other-uses-1167030424.jpg" alt="Explorer Badge">
                        </div>
                        <div class="badge-info">
                            <h4>Explorer</h4>
                            <p>Visited 5 countries</p>
                        </div>
                    </div>
                    <div class="badge">
                        <div class="badge-image">
                            <img src="https://www.shutterstock.com/image-vector/earth-globe-quote-frame-icon-260nw-1660853650.jpg" alt="Linguist Badge">
                        </div>
                        <div class="badge-info">
                            <h4>Linguist</h4>
                            <p>Learned 100 words</p>
                        </div>
                    </div>
                    <div class="badge">
                        <div class="badge-image">
                            <img src="https://www.shutterstock.com/image-vector/photo-badge-outline-vector-illustration-260nw-400769848.jpg" alt="Photographer Badge">
                        </div>
                        <div class="badge-info">
                            <h4>Photographer</h4>
                            <p>Shared 20 photos</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabId) {
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.style.display = 'none';
        });
        // Show selected tab
        document.getElementById(tabId).style.display = 'block';
    }

    // Add event listeners to tab links
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.tab-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const tabId = e.target.getAttribute('data-tab');
                showTab(tabId);
            });
        });

        // Show account tab by default
        showTab('account');
    });

    // LANGUAGE GAME
    let currentWordIndex = 0;
    let score = 0;
    let streak = 0;
    const words = [
            // French words
            { word: 'Bonjour', translation: 'Hello' },
            { word: 'Merci', translation: 'Thank you' },
            { word: 'Au revoir', translation: 'Goodbye' },
            { word: 'S\'il vous plaît', translation: 'Please' },
            { word: 'De rien', translation: 'You\'re welcome' },
            { word: 'Bonne nuit', translation: 'Good night' },
            { word: 'Comment allez-vous', translation: 'How are you' },
            { word: 'Enchanté', translation: 'Nice to meet you' },
            
            // Spanish words
            { word: 'Hola', translation: 'Hello' },
            { word: 'Gracias', translation: 'Thank you' },
            { word: 'Adiós', translation: 'Goodbye' },
            { word: 'Por favor', translation: 'Please' },
            { word: 'De nada', translation: 'You\'re welcome' },
            { word: 'Buenos días', translation: 'Good morning' },
            { word: '¿Cómo estás?', translation: 'How are you' },
            { word: 'Mucho gusto', translation: 'Nice to meet you' },

            // Italian words
            { word: 'Ciao', translation: 'Hello' },
            { word: 'Grazie', translation: 'Thank you' },
            { word: 'Arrivederci', translation: 'Goodbye' },
            { word: 'Per favore', translation: 'Please' },
            { word: 'Prego', translation: 'You\'re welcome' },
            { word: 'Buongiorno', translation: 'Good morning' },
            { word: 'Come stai', translation: 'How are you' },
            { word: 'Piacere', translation: 'Nice to meet you' },

            // German words
            { word: 'Hallo', translation: 'Hello' },
            { word: 'Danke', translation: 'Thank you' },
            { word: 'Auf Wiedersehen', translation: 'Goodbye' },
            { word: 'Bitte', translation: 'Please' },
            { word: 'Gern geschehen', translation: 'You\'re welcome' },
            { word: 'Guten Morgen', translation: 'Good morning' },
            { word: 'Wie geht es dir', translation: 'How are you' },
            { word: 'Freut mich', translation: 'Nice to meet you' },

            // Japanese words
            { word: 'こんにちは (Konnichiwa)', translation: 'Hello' },
            { word: 'ありがとう (Arigatou)', translation: 'Thank you' },
            { word: 'さようなら (Sayounara)', translation: 'Goodbye' },
            { word: 'お願いします (Onegaishimasu)', translation: 'Please' },
            { word: 'どういたしまして (Douitashimashite)', translation: 'You\'re welcome' },
            { word: 'おはようございます (Ohayou gozaimasu)', translation: 'Good morning' },
            { word: 'お元気ですか (Ogenki desu ka)', translation: 'How are you' },
            { word: 'はじめまして (Hajimemashite)', translation: 'Nice to meet you' },

            // Korean words
            { word: '안녕하세요 (Annyeonghaseyo)', translation: 'Hello' },
            { word: '감사합니다 (Gamsahamnida)', translation: 'Thank you' },
            { word: '안녕히 가세요 (Annyeonghi gaseyo)', translation: 'Goodbye' },
            { word: '부탁합니다 (Butakhamnida)', translation: 'Please' },
            { word: '천만에요 (Cheonmaneyo)', translation: 'You\'re welcome' },
            { word: '좋은 아침입니다 (Joeun achimimnida)', translation: 'Good morning' },
            { word: '어떻게 지내세요 (Eotteoke jinaeseyo)', translation: 'How are you' },
            { word: '만나서 반갑습니다 (Mannaseo bangapseumnida)', translation: 'Nice to meet you' }
        ];

        function initializeGame() {
            const submitButton = document.getElementById('submit-answer');
            const answerInput = document.getElementById('answer');
            const currentWordElement = document.getElementById('current-word');

            if (currentWordElement) {
                currentWordElement.textContent = words[currentWordIndex].word;
            }

            if (submitButton) {
                submitButton.addEventListener('click', checkAnswer);
            }

            // if (answerInput) {
            //     answerInput.addEventListener('keypress', (e) => {
            //         if (e.key === 'Enter') {
            //             checkAnswer();
            //         }
            //     });
            // }
        }
        // Tab switching function
        function showTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(tabId);
            if (selectedTab) {
                selectedTab.style.display = 'block';
                // Initialize game if game tab is selected
                if (tabId === 'game') {
                    initializeGame();
                }
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Add click handlers to tab links
            const tabLinks = document.querySelectorAll('.tab-link');
            if (tabLinks) {
                tabLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const tabId = e.target.getAttribute('data-tab');
                        showTab(tabId);
                    });
                });
            }

            // Show default tab
            showTab('account');
        });
        document.addEventListener('DOMContentLoaded', () => {
        const submitButton = document.getElementById('submitAnswer');
        const answerInput = document.getElementById('answer');

        // Add click event listener to submit button
        submitButton.addEventListener('click', checkAnswer);

        // Add enter key listener to input field
        answerInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });
        document.getElementById('current-word').textContent = words[currentWordIndex].word;
    });

        function checkAnswer() {
            const answer = document.getElementById('answer').value.toLowerCase().trim();
            const correctAnswer = words[currentWordIndex].translation.toLowerCase();

            if (answer === correctAnswer) {
                score += 10;
                streak += 1;
                // Add bonus points for streaks
                if (streak > 5) score += 5;  // Bonus for 5+ streak
                if (streak > 10) score += 10; // Additional bonus for 10+ streak
                showSuccessMessage('Correct! Keep going!');
            } else {
                streak = 0;
                showErrorMessage(`Wrong! The correct answer is: ${words[currentWordIndex].translation}`);
            }

            // Update display
            document.getElementById('score').textContent = score;
            document.getElementById('streak').textContent = streak;

            // Move to next word
            currentWordIndex = (currentWordIndex + 1) % words.length;
            document.getElementById('current-word').textContent = words[currentWordIndex].word;
            document.getElementById('answer').value = '';
        }
        function showSuccessMessage(message) {
            const gameCard = document.querySelector('.game-card');
            const messageDiv = document.createElement('div');
            messageDiv.textContent = message;
            messageDiv.style.color = 'green';
            messageDiv.style.marginTop = '10px';
            gameCard.appendChild(messageDiv);
            setTimeout(() => messageDiv.remove(), 2000);
        }

        function showErrorMessage(message) {
            const gameCard = document.querySelector('.game-card');
            const messageDiv = document.createElement('div');
            messageDiv.textContent = message;
            messageDiv.style.color = 'red';
            messageDiv.style.marginTop = '10px';
            gameCard.appendChild(messageDiv);
            setTimeout(() => messageDiv.remove(), 1000);
        }
    </script>
    <script type="module">
        import { 
            getAuth, 
            onAuthStateChanged, 
            updateProfile, 
            updatePassword,
            reauthenticateWithCredential,
            signOut
        } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";

        import { 
            getFirestore,
            doc,
            getDoc,
            updateDoc,
            serverTimestamp
        } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";  

        import { 
            getStorage, 
            ref, 
            uploadBytesResumable, 
            getDownloadURL 
        } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-storage.js";

        import { firebaseApp } from "./stuff.js";

        const db = getFirestore(firebaseApp);

        // Function to show alerts
        function showAlert(message, type = 'success') {
            const alertContainer = document.getElementById('alert-container');
            const alertElement = alertContainer.querySelector('.alert');
    
            alertElement.className = `alert alert-${type}`;
            alertElement.textContent = message;
            alertContainer.style.display = 'block';
    
            // Auto hide after 5 seconds
            setTimeout(() => {
                alertContainer.style.display = 'none';
            }, 5000);
        }

        // Handle profile settings form submission
        document.getElementById('settings-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const auth = getAuth(firebaseApp);
            const user = auth.currentUser;
            
            if (!user) {
                showAlert('Please log in to save settings', 'danger');
                return;
            }

            const username = document.getElementById('username').value.trim();
            const submitButton = document.getElementById('save-profile-btn');
            const spinner = submitButton.querySelector('.spinner-border');
            
            try {
                // Show loading state
                submitButton.disabled = true;
                spinner.classList.remove('d-none');

                // Update user data in Firestore
                const userDocRef = doc(db, 'users', user.uid);
                await updateDoc(userDocRef, {
                    // changed here from username:username to name:username 
                    name: username,
                    updatedAt: serverTimestamp()
                });

                // Update display name in Auth
                await updateProfile(user, {
                    displayName: username
                });

                // Update on profile page
                document.querySelector('.user-info h3').textContent = username;
                showAlert('Profile updated successfully!');
            } catch (error) {
                console.error('Error updating settings:', error);
                showAlert(`Error updating settings: ${error.message}`, 'danger');
            } finally {
                submitButton.disabled = false;
                spinner.classList.add('d-none');
            }
        });

        // Load initial user data
        document.addEventListener('DOMContentLoaded', async () => {
            const auth = getAuth(firebaseApp);
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    try {
                        const userDocRef = doc(db, 'users', user.uid);
                        const userDoc = await getDoc(userDocRef);
                        
                        if (userDoc.exists()) {
                            const userData = userDoc.data();
                            // changed here from userDate.username to userData.name 
                            document.getElementById('username').value = userData.name || '';
                            document.querySelector('.user-info h3').textContent = userData.name || '';
                        }
                    } catch (error) {
                        console.error('Error loading user data:', error);
                        showAlert('Error loading user data. Please try again.', 'danger');
                    }
                } else {
                    window.location.href = 'login.html';
                }
                });
            });

        // function toggleButtonLoading(buttonId, isLoading) {
        //     const button = document.getElementById(buttonId);
        //     const spinner = button.querySelector('.spinner-border');
            
        //     button.disabled = isLoading;
        //     if (isLoading) {
        //         spinner.classList.remove('d-none');
        //         button.querySelector('span:not(.spinner-border)') && 
        //             button.querySelector('span:not(.spinner-border)').classList.add('d-none');
        //     } else {
        //         spinner.classList.add('d-none');
        //         button.querySelector('span:not(.spinner-border)') && 
        //             button.querySelector('span:not(.spinner-border)').classList.remove('d-none');
        //     }
        // }

        document.addEventListener('DOMContentLoaded', async () => {
    const auth = getAuth(firebaseApp);
    
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            try {
                // Get user document from Firestore
                const userDocRef = doc(db, 'users', user.uid);
                const userDoc = await getDoc(userDocRef);
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    // Update form fields
                    document.getElementById('username').value = userData.username || '';
                    
                    // Update profile picture if exists
                    if (userData.photoURL) {
                        document.getElementById('profile-preview').src = userData.photoURL;
                    }
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                showAlert('Error loading user data. Please try again.', 'danger');
            }
            } else {
                window.location.href = 'index.html';
                }
            });
        });

        document.addEventListener('DOMContentLoaded', async () => {
    const auth = getAuth(firebaseApp);
    
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            try {
                // Get user document from Firestore
                const userDocRef = doc(db, 'users', user.uid);
                const userDoc = await getDoc(userDocRef);
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    // Update form fields
                    // changed here from userDate.username to userData.name 
                    document.getElementById('username').value = userData.name || '';

                    
                    // Update profile picture if exists
                    if (userData.photoURL) {
                        document.getElementById('profile-preview').src = userData.photoURL;
                    }
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                showAlert('Error loading user data. Please try again.', 'danger');
            }
        } else {
            window.location.href = 'login.html';
        }
    });
});

// Handle profile settings form submission
document.getElementById('settings-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const auth = getAuth(firebaseApp);
    const user = auth.currentUser;
    
    if (!user) {
        showAlert('Please log in to save settings', 'danger');
        return;
    }

    const username = document.getElementById('username').value.trim();
    
    try {
        // toggleButtonLoading('save-profile-btn', true);

        // Update user data in Firestore
        const userDocRef = doc(db, 'users', user.uid);
        await updateDoc(userDocRef, {
            // changed here from username:username to name:username 
            name: username,
            // WANT OR NOT!!!!!
            updatedAt: serverTimestamp()
        });

        // Update display name in Auth
        await updateProfile(user, {
            displayName: username
        });

        // Update UI
        document.querySelector('.user-info h3').textContent = username;
        showAlert('Profile updated successfully!');
    } catch (error) {
        console.error('Error updating settings:', error);
        showAlert(`Error updating settings: ${error.message}`, 'danger');
    } finally {
        // toggleButtonLoading('save-profile-btn', false);
        }
    });

// Handle profile picture upload
document.getElementById('profilePic').addEventListener('change', async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const auth = getAuth(firebaseApp);
    const user = auth.currentUser;
    
    if (!user) {
        showAlert('Please log in to update profile picture', 'danger');
        return;
    }

    // Validate file type and size
    if (!file.type.startsWith('image/')) {
        showAlert('Please select an image file', 'danger');
        return;
    }

    if (file.size > 5 * 1024 * 1024) { // 5MB limit
        showAlert('Image size should be less than 5MB', 'danger');
        return;
    }

    try {
        const progressBar = document.getElementById('upload-progress');
        const progressBarInner = progressBar.querySelector('.progress-bar');
        progressBar.classList.remove('d-none');

        // Create storage reference
        const storage = getStorage(firebaseApp);
        const fileRef = ref(storage, `profile-pictures/${user.uid}/${file.name}`);

        // Upload file with progress monitoring
        const uploadTask = uploadBytesResumable(fileRef, file);
        
        uploadTask.on('state_changed', 
            (snapshot) => {
                // Update progress bar
                const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                progressBarInner.style.width = progress + '%';
                progressBarInner.textContent = Math.round(progress) + '%';
            },
            (error) => {
                console.error('Error uploading file:', error);
                showAlert('Error uploading profile picture', 'danger');
                progressBar.classList.add('d-none');
            },
            async () => {
                // Upload completed successfully
                const downloadURL = await getDownloadURL(fileRef);

                // Update auth profile
                await updateProfile(user, {
                    photoURL: downloadURL
                });

                // Update Firestore document
                const userDocRef = doc(db, 'users', user.uid);
                await updateDoc(userDocRef, {
                    photoURL: downloadURL,
                    updatedAt: serverTimestamp()
                });

                // Update UI
                document.getElementById('profile-preview').src = downloadURL;
                document.querySelector('.user-info img').src = downloadURL;
                
                showAlert('Profile picture updated successfully!');
                progressBar.classList.add('d-none');
            }
        );
    } catch (error) {
        console.error('Error updating profile picture:', error);
        showAlert('Error updating profile picture: ' + error.message, 'danger');
    }
});

// Handle logout
async function logout() {
    try {
        const auth = getAuth(firebaseApp);
        await signOut(auth);
        window.location.href = 'login.html';
    } catch (error) {
        console.error('Error logging out:', error);
        showAlert('Error logging out: ' + error.message, 'danger');
        }
    }
    </script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="navbarLoader.js"></script>
    <footer>
        <p>&copy; 2024 ROAMEO. All Rights Reserved.</p>
    </footer>
</body>
</html>